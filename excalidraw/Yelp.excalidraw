{"type":"excalidraw","version":2,"source":"https://app.excalidraw.com","metadata":{"id":"2ZenCnvTRRE","workspace":"6lsqOkFWqjK","name":"Yelp","created":"2025-10-10T23:27:18.155Z","updated":"2025-10-23T18:35:51.500Z","collection":null,"creator":"Alx6QpYT9Vj","updater":"Alx6QpYT9Vj","isPrivate":true,"pinned":false},"elements":[{"id":"7mmFbB9DEOuyap_PScxer","type":"text","x":736.84765625,"y":-1884.63671875,"width":1608.0535888671873,"height":2850,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a1","roundness":null,"seed":1341239052,"version":6940,"versionNonce":1684425977,"isDeleted":false,"boundElements":[],"updated":1761244544649,"link":null,"locked":false,"text":"Clarifying questions\n\n- Interaction Type - Are we serving this as a feed of nearby recommendations or a search-driven retrieval?\n- Objective – Are we optimizing for engagement (clicks, calls, map views) or offline conversions (visits, check-ins)?\n- How many users? 100M\n- What categories? salon, cafe, restaurant\n- Monetization: exclude ads from the design?\n- Constraint: latency budget? freshness, personalized ranking?\n- cold start\n- scalability?\n\n\nHigh level design:\n- Assuming both ranking and retrieval (through search), goal is to maximize user engagment (direction), as well as DAU\n-- guardrail: report rate, dislike rate, bad click, rating drops \n- Model is to get a query (either request for feed, or request from search)\n-- Get input and output a list of locations sorted by probablity of engagement\n\nData engineering\n- user (demographic, id, cluster of interest, date joined)\n- location (latitude, logtitude, rating, type)\n- interactions (event id, user id, location id, interaction type (click, comment, review, long view, check direction, visit)\n\nlabel:\n- visit? high quality, aligned with metric, but sparse, noisy, tech dependant, privacy\n-- same to review and rating\n- click? click bait-y, noisy, dose not show engagement\n- find direction? seems to show curiosity and conviction, also not sparse\n- weighted sum of explicit (review, rating, visit, click). weighted per type of business as well.\n- negative samples are the ones without interactions, also this is a regression problem\n\nFeature engineering:\n- User: user id (embedding), user age (one hot), user interest cluster, user request location (city, zip-code, country), user age on website,\n-- user previous visits (distance, commute diff - aggergated multival), user previous type of location visit (bag of words)\n- request: time of the day, day of the week, holiday in country(one hot), device, network, \n- Interactions (only used in ranker): user distance to location, user time to location, user have seen similar places before, user sentiment on similar\n-- time to close - commute\n- Location: walkability, bike-ability, parking, working day, working hours, daily visits (geo APIs), review (BERT), rating (Onehot- 50 buckets)\n- feature stores for TSS, \n\nModeling:\n- latency: both retrieval and ranking is needed\n- candidate generation: (location based (searched, or device), open now),\n- retrieval (if needed): generates a smaller list \n-- simpler model (two towers, ANN LSH or SCANN) , logit, same loss (regression on all tasks weighted)\n- light ranker (distilled version, but not needed given size is small)\n- ranker: single tower with all features said above, with position feautre for bias detection, loss regression loss (MAE, MSE)\n\nArchitecture:\nBoth are MLP, we can use regression, xgboost (but not so good at continual training, non-linear seperation)\nRetrieval (contrastive loss, ANN kd-tree) sofmax (dot-product(user emb, item emb) over positives + negatives\nRanker can have in-graph user sequence modeling\nDCN and DCN v2 for embedding feature crosses\nFeature crosses using neuroarchitectural search\nMMOE given we are doing multi-tasking on all these tasks (helps with task competition) - or simply focal loss\nTransformer layer for sequences\nLayer norm and resnet for stablity\nUsing calibeartion layer (isotonic, platt scaling)\n\nModel training:\n- down sampling negatives \n- keep explicit negative (bad reviews)\n- \n\n\nEvaluation:\n- offline:\n-- NDCG given relevance is float for aggregated results\n-- recall @k\n-- model weighed MSE + BCE (weights either through regression (offline to online) or heuristics)\n\n- online:\n-- CTR\n-- churn rate, revenue lift\n-- store visits, DAU\n-- gaurdrail: negative comments, bad rating,\n\n\nServing:\n- latency improvement:\n-- pruning: layer based\n-- AQT\n-- distillation (light ranker)\n-- embedding optimization\n- caching (features, preduction, embeddings)\n\n\n\n\n\n\nDeployment:\n- shadowing\n- canarying\n- A/B testing (on metrics above) 1-100% flag flip\n-- multi-arm bandit, \n- holdback experiment\n- model repositoty (continual training, rollback)\n- monitor alert (quality auc, MAE, business, system: latency, qps, throuput, memory, GPU util)\n- retraining: data drif response, online + weekly retraining\n\n\n\nBiases:\n- position bias: feature\n- selection bias: e-greedy exploration (gaurdrail on churn), \n- popularity bias: penalize popularity\n\n\nCold start:\n- users: get information as possible, fall back model (to simpler model based on pref).\n- items: retrieval and ranking have context in model\n\n","fontSize":20,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"Clarifying questions\n\n- Interaction Type - Are we serving this as a feed of nearby recommendations or a search-driven retrieval?\n- Objective – Are we optimizing for engagement (clicks, calls, map views) or offline conversions (visits, check-ins)?\n- How many users? 100M\n- What categories? salon, cafe, restaurant\n- Monetization: exclude ads from the design?\n- Constraint: latency budget? freshness, personalized ranking?\n- cold start\n- scalability?\n\n\nHigh level design:\n- Assuming both ranking and retrieval (through search), goal is to maximize user engagment (direction), as well as DAU\n-- guardrail: report rate, dislike rate, bad click, rating drops \n- Model is to get a query (either request for feed, or request from search)\n-- Get input and output a list of locations sorted by probablity of engagement\n\nData engineering\n- user (demographic, id, cluster of interest, date joined)\n- location (latitude, logtitude, rating, type)\n- interactions (event id, user id, location id, interaction type (click, comment, review, long view, check direction, visit)\n\nlabel:\n- visit? high quality, aligned with metric, but sparse, noisy, tech dependant, privacy\n-- same to review and rating\n- click? click bait-y, noisy, dose not show engagement\n- find direction? seems to show curiosity and conviction, also not sparse\n- weighted sum of explicit (review, rating, visit, click). weighted per type of business as well.\n- negative samples are the ones without interactions, also this is a regression problem\n\nFeature engineering:\n- User: user id (embedding), user age (one hot), user interest cluster, user request location (city, zip-code, country), user age on website,\n-- user previous visits (distance, commute diff - aggergated multival), user previous type of location visit (bag of words)\n- request: time of the day, day of the week, holiday in country(one hot), device, network, \n- Interactions (only used in ranker): user distance to location, user time to location, user have seen similar places before, user sentiment on similar\n-- time to close - commute\n- Location: walkability, bike-ability, parking, working day, working hours, daily visits (geo APIs), review (BERT), rating (Onehot- 50 buckets)\n- feature stores for TSS, \n\nModeling:\n- latency: both retrieval and ranking is needed\n- candidate generation: (location based (searched, or device), open now),\n- retrieval (if needed): generates a smaller list \n-- simpler model (two towers, ANN LSH or SCANN) , logit, same loss (regression on all tasks weighted)\n- light ranker (distilled version, but not needed given size is small)\n- ranker: single tower with all features said above, with position feautre for bias detection, loss regression loss (MAE, MSE)\n\nArchitecture:\nBoth are MLP, we can use regression, xgboost (but not so good at continual training, non-linear seperation)\nRetrieval (contrastive loss, ANN kd-tree) sofmax (dot-product(user emb, item emb) over positives + negatives\nRanker can have in-graph user sequence modeling\nDCN and DCN v2 for embedding feature crosses\nFeature crosses using neuroarchitectural search\nMMOE given we are doing multi-tasking on all these tasks (helps with task competition) - or simply focal loss\nTransformer layer for sequences\nLayer norm and resnet for stablity\nUsing calibeartion layer (isotonic, platt scaling)\n\nModel training:\n- down sampling negatives \n- keep explicit negative (bad reviews)\n- \n\n\nEvaluation:\n- offline:\n-- NDCG given relevance is float for aggregated results\n-- recall @k\n-- model weighed MSE + BCE (weights either through regression (offline to online) or heuristics)\n\n- online:\n-- CTR\n-- churn rate, revenue lift\n-- store visits, DAU\n-- gaurdrail: negative comments, bad rating,\n\n\nServing:\n- latency improvement:\n-- pruning: layer based\n-- AQT\n-- distillation (light ranker)\n-- embedding optimization\n- caching (features, preduction, embeddings)\n\n\n\n\n\n\nDeployment:\n- shadowing\n- canarying\n- A/B testing (on metrics above) 1-100% flag flip\n-- multi-arm bandit, \n- holdback experiment\n- model repositoty (continual training, rollback)\n- monitor alert (quality auc, MAE, business, system: latency, qps, throuput, memory, GPU util)\n- retraining: data drif response, online + weekly retraining\n\n\n\nBiases:\n- position bias: feature\n- selection bias: e-greedy exploration (gaurdrail on churn), \n- popularity bias: penalize popularity\n\n\nCold start:\n- users: get information as possible, fall back model (to simpler model based on pref).\n- items: retrieval and ranking have context in model\n\n","autoResize":false,"lineHeight":1.25},{"id":"91J5tDzOrJ3wsmXYL_ZgS","type":"rectangle","x":2411.53125,"y":-875.19921875,"width":198.39062499999994,"height":144.62109375,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a2","roundness":{"type":3},"seed":233966516,"version":109,"versionNonce":1535067316,"isDeleted":false,"boundElements":[{"type":"text","id":"upvID275HuUnCXZOItyd4"}],"updated":1760142217861,"link":null,"locked":false},{"id":"upvID275HuUnCXZOItyd4","type":"text","x":2432.5666275024414,"y":-827.888671875,"width":156.3198699951172,"height":50,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a3","roundness":null,"seed":628470284,"version":40,"versionNonce":90355212,"isDeleted":false,"boundElements":[],"updated":1760142225085,"link":null,"locked":false,"text":"location fitering\ntime filtering ","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"91J5tDzOrJ3wsmXYL_ZgS","originalText":"location fitering\ntime filtering ","autoResize":true,"lineHeight":1.25},{"id":"ybdEiZrsGcvPHl3W6tE4k","type":"rectangle","x":2671.515625,"y":-867.19921875,"width":165.06640625,"height":130.34375,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a4","roundness":{"type":3},"seed":299737868,"version":44,"versionNonce":2109015988,"isDeleted":false,"boundElements":[{"type":"text","id":"VlnH3q2srk2luFlHFAJ_-"}],"updated":1760142229670,"link":null,"locked":false},{"id":"VlnH3q2srk2luFlHFAJ_-","type":"text","x":2719.508857727051,"y":-814.52734375,"width":69.07994079589844,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a5","roundness":null,"seed":1223376652,"version":10,"versionNonce":1428299788,"isDeleted":false,"boundElements":[],"updated":1760142230546,"link":null,"locked":false,"text":"retrival","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"ybdEiZrsGcvPHl3W6tE4k","originalText":"retrival","autoResize":true,"lineHeight":1.25},{"id":"jY-20VN_1bRa_0NaU20kK","type":"text","x":2620.890625,"y":-710.1953125,"width":77.9599609375,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a6","roundness":null,"seed":340430092,"version":21,"versionNonce":176693004,"isDeleted":false,"boundElements":[],"updated":1760142293867,"link":null,"locked":false,"text":"O(100k)","fontSize":20,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"O(100k)","autoResize":true,"lineHeight":1.25},{"id":"ZEZtsRWrtMfTv5ojdFAaD","type":"text","x":2384,"y":-696,"width":56.059967041015625,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"a9","roundness":null,"seed":536851852,"version":7,"versionNonce":890576012,"isDeleted":false,"boundElements":[],"updated":1760142254884,"link":null,"locked":false,"text":"O(1M)","fontSize":20,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"O(1M)","autoResize":true,"lineHeight":1.25},{"id":"dNsVlry-T4a6aDuXnr96t","type":"rectangle","x":2881.71875,"y":-892.4453125,"width":174.125,"height":182.0546875,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aA","roundness":{"type":3},"seed":1647691060,"version":62,"versionNonce":1977783564,"isDeleted":false,"boundElements":[{"type":"text","id":"Ff6W-DhvTQ4puoU-rYr4p"}],"updated":1760142260546,"link":null,"locked":false},{"id":"Ff6W-DhvTQ4puoU-rYr4p","type":"text","x":2939.2212829589844,"y":-813.91796875,"width":59.11993408203125,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aB","roundness":null,"seed":70465588,"version":8,"versionNonce":605078580,"isDeleted":false,"boundElements":[],"updated":1760142261677,"link":null,"locked":false,"text":"ranker","fontSize":20,"fontFamily":5,"textAlign":"center","verticalAlign":"middle","containerId":"dNsVlry-T4a6aDuXnr96t","originalText":"ranker","autoResize":true,"lineHeight":1.25},{"id":"JIpYwoyj0xuXiWUwxlUCn","type":"text","x":2856.9921875,"y":-696.8359375,"width":51.39996337890625,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aC","roundness":null,"seed":1131631756,"version":66,"versionNonce":183122188,"isDeleted":false,"boundElements":[],"updated":1760142297030,"link":null,"locked":false,"text":"O(1k)","fontSize":20,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"O(1k)","autoResize":true,"lineHeight":1.25},{"id":"q8kKVqVSm4ggrxHBZhL2V","type":"text","x":3067.467987060547,"y":-703.4375,"width":58.47998046875,"height":25,"angle":0,"strokeColor":"#1e1e1e","backgroundColor":"transparent","fillStyle":"solid","strokeWidth":2,"strokeStyle":"solid","roughness":1,"opacity":100,"groupIds":[],"frameId":null,"index":"aD","roundness":null,"seed":2066494388,"version":71,"versionNonce":2131845940,"isDeleted":false,"boundElements":[],"updated":1760142303117,"link":null,"locked":false,"text":"O(20)","fontSize":20,"fontFamily":5,"textAlign":"left","verticalAlign":"top","containerId":null,"originalText":"O(20)","autoResize":true,"lineHeight":1.25}],"appState":{"viewBackgroundColor":"#ffffff","lockedMultiSelections":{}},"files":{}}